### SDN

OpenShift uses a software-defined networking (SDN) model to manage communication between pods, services, and nodes. When you install OpenShift (using IPI or UPI), you configure three key networks:
1. Cluster Network

Purpose: Provides pod-to-pod communication across the cluster. Each pod gets an IP address from this network range.

Characteristics:

    CIDR (Classless Inter-Domain Routing) range for all pods in the cluster.

    Network plugins (e.g., OVN-Kubernetes or OpenShiftSDN) implement routing for pods.

    Each node gets a subnet for its pods.

Example Configuration:

clusterNetwork:
  - cidr: 10.128.0.0/14
    hostPrefix: 23

    10.128.0.0/14 → Pod IP range.

    hostPrefix: 23 → Each node gets a /23 subnet (approximately 512 IPs for pods).

Example Scenario:

    Node1 pod range: 10.128.0.0/23

    Node2 pod range: 10.128.2.0/23

    A pod on Node1 can talk to a pod on Node2 directly using pod IPs.

2. Service Network

Purpose: Provides virtual IP addresses for Kubernetes services. Pods do not get these IPs; these are for service abstraction.

Characteristics:

    A cluster-wide virtual IP range for all services.

    Implemented using kube-proxy (or OVN in OpenShift 4).

    Used for service discovery inside the cluster.

Example Configuration:

serviceNetwork:
  - 172.30.0.0/16

    172.30.0.0/16 → Service IP range.

    When you create a ClusterIP service, it gets an IP from this range.

Example Scenario:

    Service nginx-service → IP: 172.30.25.10

    Pods in the cluster communicate with nginx-service via 172.30.25.10 (or DNS name nginx-service.namespace.svc).

3. Machine Network

Purpose: Represents the underlying physical or cloud network where nodes (machines) reside. This is the network that nodes use for communication with each other and the API.

Characteristics:

    Usually matches the node IP subnet (e.g., your AWS VPC, VMware network, or bare-metal subnet).

    Used by the installer for host discovery and API endpoint.

Example Configuration:

machineNetwork:
  - cidr: 192.168.0.0/24

    192.168.0.0/24 → Nodes and API endpoint IP range.

    The cluster API (api.cluster.example.com) and nodes have IPs from this range.

Example Scenario:

    Node1 IP: 192.168.0.11

    Node2 IP: 192.168.0.12

    API IP: 192.168.0.10

How They Work Together

    Cluster Network (Pods) → 10.128.0.0/14

    Service Network (Services) → 172.30.0.0/16

    Machine Network (Nodes) → 192.168.0.0/24

Communication Flow Example:

    Pod A (10.128.0.5) on Node1 needs to access Pod B (10.128.2.8) on Node2: The SDN handles pod-to-pod routing across the cluster network.

    Pod A wants to access a service (e.g., MySQL service): DNS resolves mysql.default.svc.cluster.local → 172.30.12.20 (service IP). Traffic is routed via kube-proxy or OVN to a backend Pod.

    Node-to-node communication (for API, etc.): Nodes use 192.168.0.x (machine network) for internal control plane communication.

Visualization:

+------------------------------------------------------------+
| Machine Network: 192.168.0.0/24 (Nodes, API endpoint)     |
|   Node1: 192.168.0.11    Node2: 192.168.0.12             |
|                                                            |
|   Cluster Network: 10.128.0.0/14 (Pods)                   |
|     Node1 Pods: 10.128.0.0/23   Node2 Pods: 10.128.2.0/23 |
|                                                            |
|   Service Network: 172.30.0.0/16 (Services)               |
|     MySQL Service IP: 172.30.12.20                        |
+------------------------------------------------------------+

