### Creating and Accessing Virtual Machines from the Command Line

Creating Virtual Machines From the Command Line:
- YAML configuration files: Declarative approach with oc apply -f <file>.yaml
- Ansible Playbooks: Automate VM provisioning
- virtctl commands: CLI tool for KubeVirt-based VM management

Creating a VM Using a YAML Manifest:
- A YAML file defines VM properties, such as the image, CPU, memory, and storage.
```yaml
apiVersion: kubevirt.io/v1
kind: VirtualMachine
metadata:
  name: postgresql-rhel9
spec:
  runStrategy: Always
  template:
    metadata: {}
    spec:
      dataVolumeTemplates:
      - metadata:
          name: postgresql-rhel9
        spec:
          source:
            registry:
              url: "registry.redhat.io/rhel9/postgresql-15:latest"  # Image location
              secretRef: data-source-secret  # Secret for authentication
      domain:
        memory:
          guest: 512Mi
      terminationGracePeriodSeconds: 180
      volumes:
        - dataVolume:
            name: rhel-9-minimal-volume
          name: rootdisk
```
- To create the VM from this YAML file, run: `oc apply -f vm-manifest.yaml`
- To edit an existing VMâ€™s YAML configuration: `oc edit vm postgresql-rhel9`

Managing a VM with CLI Commands:
- Start a VM: `virtctl start postgresql-rhel9`
- Stop a VM: `virtctl stop postgresql-rhel9`
- Restarting a VM: `virtctl restart postgresql-rhel9`
- oc delete vm postgresql-rhel9: `Deleting a VM`

Creating a VM Manifest Using virtctl:
- Instead of manually writing a YAML file, you can generate it using virtctl:
`virtctl create vm --name postgresql-rhel9 --namespace production --memory=5Gi`
- This command creates a YAML manifest for a VM with:
  - Name: postgresql-rhel9
  - Namespace: production
  - Memory: 5 GiB
- You can also attach an existing data volume:
`virtctl create vm --name postgresql-rhel9 --volume-datasource=src:postgresql-project/postgresql-dv`

Accessing the VM:
- Serial console: `virtctl console postgresql-rhel9`
- VNC console: `virtctl vnc postgresql-rhel9`
- SSH Access: `virtctl ssh -i .ssh/lab_rsa --username developer postgresql-rhel9`

Port Forwarding:
- To forward a local port to the VM: `virtctl port-forward vm/postgresql-rhel9 22080:80`
- Alternatively, using oc: `oc port-forward pod/virt-launcher-postgresql-rhel9-gbxws 22080:80`

Exposing a VM as a Service:
- `virtctl expose vm postgresql-rhel9 --name postgresql-service --type ClusterIP --port 5432`
- To verify the service `oc get services`

---
### Exercise 

Create a RHEL 9 VM using virtctl wiht YAML manifest:
- Get available datasorce for vm build : `oc get datasource -A`
- Creates a YAML manifest for the VM with 2Gi of RAM and references the rhel9 data source.
`virtctl create vm \
 --name rhel9-database \
 --namespace vm --memory=2Gi \
 --volume-datasource=src:openshift-virtualization-os-images/rhel9`
