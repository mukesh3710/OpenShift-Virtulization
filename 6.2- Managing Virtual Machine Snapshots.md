### Managing Virtual Machine Snapshots

- Virtual Machine (VM) snapshots capture the current state of a VM, including the OS, applications, and all attached disks. They provide a rollback mechanism for system administrators and developers to safeguard against changes that might lead to system instability.

Taking Snapshots:
- Running (Live Snapshots) – Requires the QEMU guest agent to ensure file system consistency.
- Stopped – Recommended if the QEMU guest agent is not installed.

Snapshots are supported based on the storage backend::
- Red Hat OpenShift Data Foundation (ODF) supports snapshots.
- Other storage classes depend on the Container Storage Interface (CSI) driver.
- Warning: If a disk is on a storage class that does not support snapshots, OpenShift will notify you, and that disk will remain unchanged when restoring a snapshot.

Creating Snapshots:
- Web Console: Navigate to Virtualization → Virtual Machines and select a VM. Go to the Snapshots tab → Click Take snapshot → Fill in details and save. If the VM is running without the QEMU guest agent, stop the VM first.
- Define a snapshot in a YAML file (snapshot.yaml):
```yaml
apiVersion: snapshot.kubevirt.io/v1alpha1
kind: VirtualMachineSnapshot
metadata:
  name: mariadb-server-2024-10-23
spec:
  source:
    apiGroup: kubevirt.io
    kind: VirtualMachine
    name: mariadb-server
```

Restoring Snapshots:
- Web Console: Stop the VM. Go to Snapshots → Locate snapshot → Restore Virtual Machine. Restart the VM after restoration.
- Command Line: List available snapshots: `oc get virtualmachinesnapshot`. Define a restore resource (restore.yaml)
```yaml
apiVersion: snapshot.kubevirt.io/v1alpha1
kind: VirtualMachineRestore
metadata:
  name: restore-db
spec:
  target:
    apiGroup: kubevirt.io
    kind: VirtualMachine
    name: mariadb-server
  virtualMachineSnapshotName: mariadb-server-2024-10-23
```
- Considerations:  If a disk was removed after taking a snapshot, it will be recreated. If a disk was added, OpenShift removes it upon restoration.

Deleting Snapshots: Snapshots consume storage and should be deleted when no longer needed.
- Web Console: Go to Snapshots → Locate the snapshot → Click Delete.
- Command Line: `oc delete virtualmachinesnapshot mariadb-server-2024-10-23`

Kubernetes Volume Snapshots:
- Since OpenShift VM snapshots rely on Kubernetes volume snapshots, each VM disk has a corresponding Persistent Volume Claim (PVC).
